#include "temp_table.h"
/* kom, temp, k */
// #define MDF_LOCAL_LOG_LEVEL MDF_LOG_INFO
#define ILLEGAL_TEMP 25
#define ILLEGAL_KOM 50

static const char *TAG = "temp_table";

const float g_temp_table[72][3] = {
    {470.0207, -20, 0},
    {444.1102, -19, -0.038594392},
    {419.7806, -18, -0.041102197},
    {396.9266, -17, -0.043756016},
    {375.4503, -16, -0.046562955},
    {355.261, -15, -0.049531187},
    {336.2743, -14, -0.052668447},
    {318.4118, -13, -0.055983205},
    {301.6008, -12, -0.059484861},
    {285.7737, -11, -0.063182769},
    {270.8672, -10, -0.067084829},
    {256.823, -9, -0.071203771},
    {243.5863, -8, -0.075547531},
    {231.1064, -7, -0.080128847},
    {219.3359, -6, -0.084958158},
    {208.2307, -5, -0.090047905},
    {197.7495, -4, -0.095408923},
    {187.854, -3, -0.101056036},
    {178.5083, -2, -0.107001081},
    {169.6789, -1, -0.113257979},
    {161.3346, 0, -0.119842288},
    {153.4462, 1, -0.126768419},
    {145.9864, 2, -0.134051851},
    {138.9297, 3, -0.141709298},
    {132.2521, 4, -0.149754403},
    {125.9314, 5, -0.158210325},
    {119.9466, 6, -0.167089961},
    {114.2781, 7, -0.176413513},
    {108.9076, 8, -0.186202402},
    {103.818, 9, -0.196479095},
    {98.993, 10, -0.207253886},
    {94.4176, 11, -0.218560126},
    {90.0777, 12, -0.230420056},
    {85.9599, 13, -0.242848123},
    {82.0517, 14, -0.255872269},
    {78.3414, 15, -0.269519985},
    {74.818, 16, -0.283816768},
    {71.4712, 17, -0.298792877},
    {68.2913, 18, -0.314475298},
    {65.269, 19, -0.330873838},
    {62.3959, 20, -0.348056107},
    {59.6638, 21, -0.366018813},
    {57.0651, 22, -0.384807789},
    {54.5927, 23, -0.404465297},
    {52.2398, 24, -0.425007438},
    {50, 25, -0.446468435},
    {47.8674, 26, -0.468911188},
    {45.8364, 27, -0.492368291},
    {43.9015, 28, -0.516822575},
    {42.0579, 29, -0.54241701},
    {40.3007, 30, -0.569087184},
    {38.6256, 31, -0.596979285},
    {37.0282, 32, -0.626017278}, 
    {35.5047, 33, -0.656383328},
    {34.0512, 34, -0.687994496},
    {32.6642, 35, -0.720980534},
    {31.3404, 36, -0.755401118},
    {30.0766, 37, -0.791264441},
    {28.8698, 38, -0.82863772},
    {27.7172, 39, -0.867603679},
    {26.616, 40, -0.908100254},
    {25.5638, 41, -0.95038966},
    {24.5582, 42, -0.994431185},
    {23.5969, 43, -1.040257984},
    {22.6776, 44, -1.087784184},
    {21.7985, 45, -1.137527016},
    {20.9576, 46, -1.189202045},
    {20.153, 47, -1.242853592},
    {19.383, 48, -1.298701299},
    {18.6459, 49, -1.356668023},
    {17.9403, 50, -1.41723356},   
    {-1, 0, 0} // for end judge , do not use
};
/*转换温度*/
float convert2temp(float kom)
{
    int n = 0;
    for(;;)
    {
        if(kom > g_temp_table[n][0]) {
            float x0 = g_temp_table[n][0];
            float y0 = g_temp_table[n][1];
            float k = g_temp_table[n + 1][2];
            if(n == 0) {
                MDF_LOGE("convert2temp fail, return [%d]", ILLEGAL_TEMP);
                return ILLEGAL_TEMP;
            }
            MDF_LOGI("n[%d] kom[%f] temp[%f]",n, kom, (kom - x0)*k + y0);
            return (kom - x0)*k + y0;
        }
        n++;
        if(g_temp_table[n][0] == -1) {
            MDF_LOGE("convert2temp fail, return [%d]", ILLEGAL_TEMP);
            return ILLEGAL_TEMP;
        }
    }
}



const float g_kom_table[72][3] = {
    {50, 17.9403, 0},
    {49, 18.6459, -0.7056},
    {48, 19.383, -0.7371},
    {47, 20.153, -0.77},
    {46, 20.9576, -0.8046},
    {45, 21.7985, -0.8409},
    {44, 22.6776, -0.8791},
    {43, 23.5969, -0.9193},
    {42, 24.5582, -0.9613},
    {41, 25.5638, -1.0056},
    {40, 26.616, -1.0522},
    {39, 27.7172, -1.1012},
    {38, 28.8698, -1.1526},
    {37, 30.0766, -1.2068},
    {36, 31.3404, -1.2638},
    {35, 32.6642, -1.3238},
    {34, 34.0512, -1.387},
    {33, 35.5047, -1.4535},
    {32, 37.0282, -1.5235},
    {31, 38.6256, -1.5974},
    {30, 40.3007, -1.6751},
    {29, 42.0579, -1.7572},
    {28, 43.9015, -1.8436},
    {27, 45.8364, -1.9349},
    {26, 47.8674, -2.031},
    {25, 50, -2.1326},
    {24, 52.2398, -2.2398},
    {23, 54.5927, -2.3529},
    {22, 57.0651, -2.4724},
    {21, 59.6638, -2.5987},
    {20, 62.3959, -2.7321},
    {19, 65.269, -2.8731},
    {18, 68.2913, -3.0223},
    {17, 71.4712, -3.1799},
    {16, 74.818, -3.3468},
    {15, 78.3414, -3.5234},
    {14, 82.0517, -3.7103},
    {13, 85.9599, -3.9082},
    {12, 90.0777, -4.1178},
    {11, 94.4176, -4.3399},
    {10, 98.993, -4.5754},
    {9, 103.818, -4.825},
    {8, 108.9076, -5.0896},
    {7, 114.2781, -5.3705},
    {6, 119.9466, -5.6685},
    {5, 125.9314, -5.9848},
    {4, 132.2521, -6.3207},
    {3, 138.9297, -6.6776},
    {2, 145.9864, -7.0567},
    {1, 153.4462, -7.4598},
    {0, 161.3346, -7.8884},
    {-1, 169.6789, -8.3443},
    {-2, 178.5083, -8.8294},
    {-3, 187.854, -9.3457},
    {-4, 197.7495, -9.8955},
    {-5, 208.2307, -10.4812},
    {-6, 219.3359, -11.1052},
    {-7, 231.1064, -11.7705},
    {-8, 243.5863, -12.4799},
    {-9, 256.823, -13.2367},
    {-10, 270.8672, -14.0442},
    {-11, 285.7737, -14.9065},
    {-12, 301.6008, -15.8271},
    {-13, 318.4118, -16.811},
    {-14, 336.2743, -17.8625},
    {-15, 355.261, -18.9867},
    {-16, 375.4503, -20.1893},
    {-17, 396.9266, -21.4763},
    {-18, 419.7806, -22.854},
    {-19, 444.1102, -24.3296},
    {-20, 470.0207, -25.9105},
    {0, -1, 0} // for end judge , do not use
};

float convert2kom(float temp)
{
    int n = 0;
    for(;;)
    {
        if(temp > g_kom_table[n][0])
        {
            float x0 = g_kom_table[n][0];
            float y0 = g_kom_table[n][1];
            float k = g_kom_table[n + 1][2];
            MDF_LOGI("n[%d] temp[%f] kom[%f]",n, temp, (temp - x0)*k + y0);
            return (temp - x0)*k + y0;
        }
        n++;
        
        if(g_kom_table[n][0] == -1)
        {
            MDF_LOGE("convert2kom fail, return [%d]", ILLEGAL_KOM);
            return ILLEGAL_KOM;
        }
    }  
}
